---
title: "<br> Univariate analysis of categorical variables"
author: "Making Sense of Criminological Data (Week 2)"
subtitle: "Sam Langton, University of Manchester"
format: revealjs
editor_options: 
  chunk_output_type: console
execute:
  echo: false
---

```{r setup}
library(knitr)
library(dplyr)
library(readr)
library(tidyr)
library(ggplot2)
library(kableExtra)
```


## Plan for today

- What is univariate analysis?
- Categorical variables
- Analysis
  - Frequencies & percentages
  - Stop-and-search example
- Visualisation

## Univariate analysis

<br>

::: columns
::: {.column width="50%"}
- Univariate = one variable
- Simple but common (and important)
- Typically **summarising** and **describing** 
:::

::: {.column width="50%"}

![](img/unicycle.gif)
:::
:::

## Categorical variables

::: columns
::: {.column width="50%"}
- Two or more categories, such as:
  - Nationality
  - Crime type
  - Education
- Nominal or ordinal

:::

::: {.column width="50%"}

![](img/categorical.png){width=70%}

:::
:::

## Analysis: frequencies 

```{r}
students_df <- data.frame(
  Student.ID  = c(12,6,34,2,41,15),
  Nationality = c("British","British","French",
                   "Dutch","French","British")
)
```

::: columns
::: {.column width="50%"}
```{r}
kable(students_df, align = "l", caption = "Raw data") 
```

:::

::: {.column width="50%"}
  
:::

:::

## Analysis: frequencies 

::: columns
::: {.column width="50%"}
```{r}
kable(students_df, align = "l", caption = "Raw data")
```
:::

::: {.column width="50%"}

<br>

```{r}
freq_df <- students_df %>% 
  group_by(Nationality) %>% 
  summarise(Count = n())

kable(freq_df, align = "l", caption = "Frequency table")
```

:::
:::

## Analysis: proportions

<br>

::: columns
::: {.column width="50%"}

```{r}
kable(freq_df, align = "l", caption = "Frequency table")
```

:::

::: {.column width="50%"}

:::
:::

## Analysis: proportions

<br>

::: columns
::: {.column width="50%"}

```{r}
kable(freq_df, align = "l", caption = "Frequency table")
```

:::

::: {.column width=50%}

```{r}
freq_df %>% 
  mutate(total = sum(Count),
         Percent = round(Count/total*100, 0)) %>% 
  select(-total, -Count) %>% 
  kable(align = "l", caption = "Proportion table")
```

:::

::: {.column width=50%}
  
:::

:::

## Take a breather

## Frequency & proportions

Are there differences between police forces with regards to the gender of individuals subject to stop-and-search?

## Frequency & proportions

Are there differences between police forces with regards to the gender of individuals subject to stop-and-search?

<center>

```{r}
mersey <- read_csv("data/2025-07-merseyside-stop-and-search.csv")

syork <- read_csv("data/2025-07-south-yorkshire-stop-and-search.csv")

mersey_gen <- count(mersey, Gender, name = "Count") %>%
  drop_na()

syork_gen <- count(syork, Gender, name = "Count") %>% 
  drop_na() %>% 
  bind_rows(data.frame(
    Gender = "Other", Count = 0 # Making categories comparable.
  ))

mersey %>% 
  sample_n(size = 20) %>%
  select(Type, Date, Latitude, Longitude, Gender, 
         `Self-defined ethnicity`) %>% 
  kable(x = ., caption = "Merseyside data sample for July 2025. Source: https://data.police.uk/data/.") %>% 
  kable_styling(font_size = 22) %>%
  scroll_box(width = "1000px", height = "420px")
```

</center>

## Frequency table 

<br>

::: columns
::: {.column width=50%}
```{r}
kable(mersey_gen, caption = "Merseyside")
```
:::
::: {.column width=50%}
```{r}
kable(syork_gen, caption = "South Yorkshire") 
```
:::
:::

<br>

<center>



</center>

## Proportion table

<br>

```{r}
mersey <- read_csv("data/2025-07-merseyside-stop-and-search.csv")

syork <- read_csv("data/2025-07-south-yorkshire-stop-and-search.csv")

mersey_gen <- count(mersey, Gender, name = "Count") %>%
  drop_na()

syork_gen <- count(syork, Gender, name = "Count") %>% 
  drop_na() %>% 
  bind_rows(data.frame(
    Gender = "Other", Count = 0 # Making categories comparable.
  ))
```

::: columns
::: {.column width=50%}
```{r}
mersey_gen %>% 
  mutate(total = sum(Count),
         Percent = round(Count/total*100, 0)) %>% 
  select(-total, -Count) %>% 
  kable(caption = "Merseyside")
```
:::
::: {.column width=50%}
```{r}
syork_gen %>% 
  mutate(total = sum(Count),
         Percent = round(Count/total*100, 0)) %>% 
  select(-total, -Count) %>% 
  kable(caption = "South Yorkshire") 
```
:::
:::

<br>

<center>

(no, it's not a mistake)

</center>

## Proportions not always 'better'

What is the gender breakdown of individuals subject to stop-and-search **in Chorlton** between **1-7 September**?


## Proportions not always 'better'

What is the gender breakdown of individuals subject to stop-and-search **in Chorlton** between **1-7 September**?

<center>

::: columns
::: {.column width=50%}
| Gender | Percent |
| :----- | -----:  |
| Female | 100     |
| Male   | 0       |
| Other  | 0       |

: Proportion table

:::

::: {.column width=50%}
  

:::
:::

<br>

Data is fictitious! 

</center>

## Proportions not always 'better'

What is the gender breakdown of individuals subject to stop-and-search **in Chorlton** between **1-7 September**?

<center>

::: columns
::: {.column width=50%}
| Gender | Percent |
| :----- | -----:  |
| Female | 100     |
| Male   | 0       |
| Other  | 0       |

: Proportion table

:::

::: {.column width=50%}
| Gender | Count  |
| :----- | ------:|
| Female | 1      |
| Male   | 0      |
| Other  | 0      |

: Frequency table

:::
:::

<br>

Data is fictitious! 
</center>

## Take a breather

## Visualisation: bar plots

::: columns
::: {.column width=50%}
```{r, fig.height=12}
syork_gen %>% 
  mutate(region = "South Yorkshire") %>% 
  bind_rows(mutate(mersey_gen,
                   region = "Merseyside")) %>% 
  ggplot() +
  geom_col(mapping = aes(x = Gender,
                         y = Count,
                         fill = Gender)) +
  facet_wrap(~region) +
  theme_bw() +
  theme(legend.position = "none",
        plot.title = element_text(size = 40),
        axis.title = element_text(size = 30),
        axis.text = element_text(size = 24),
        strip.text = element_text(size = 30))
```
:::

::: {.column width=50%}

:::




